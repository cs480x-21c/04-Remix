<!DOCTYPE html>
<html>

<head>
<link rel="shortcut icon" href="#">
</head>

<body>
  <div>
    <div>
      <h2>Bar Chart</h2>
      <div class='' id="bar"></div>
    </div>
  </div>

  <!-- https://cdnjs.com/libraries/crossfilter -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crossfilter/1.3.12/crossfilter.min.js"></script>
  <script src="https://d3js.org/d3.v4.min.js"></script>

  <script>

      var margin = {top: 20, right: 20, bottom: 70, left: 40},
          width = 600 - margin.left - margin.right,
          height = 300 - margin.top - margin.bottom;

      // Parse the date / time

      var x = d3.scale.ordinal().rangeRoundBands([0, width], .05);

      var y = d3.scale.linear().range([height, 0]);

      var xAxis = d3.svg.axis()
          .scale(x)
          .orient("bottom")
          .ticks(10);

      var yAxis = d3.svg.axis()
          .scale(y)
          .orient("left")
          .ticks(10);

      var svg = d3.select("body").append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
        .append("g")
          .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");

    d3.csv("labourForceMod.csv", function(data) {
      data.forEach(function(d) {
              d.number = +d.number;
          });

        x.domain(data.map(function(d) { return d.year; }));
        y.domain([0, d3.max(data, function(d) { return d.number; })]);

        svg.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(0," + height + ")")
            .call(xAxis)
          .selectAll("text")
            .style("text-anchor", "end")
            .attr("dx", "-.8em")
            .attr("dy", "-.55em")
            .attr("transform", "rotate(-90)" );

        svg.append("g")
            .attr("class", "y axis")
            .call(yAxis)
          .append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", 6)
            .attr("dy", ".71em")
            .style("text-anchor", "end")
            .text("Value ($)");

        svg.selectAll("bar")
            .data(data)
          .enter().append("rect")
            .style("fill", "steelblue")
            .attr("x", function(d) { return x(d.year); })
            .attr("width", x.rangeBand())
            .attr("y", function(d) { return y(d.number); })
            .attr("height", function(d) { return height - y(d.number); });



    //  var csvData = crossfilter(data);
      //
      // csvData.name = csvData.dimension(function(d) {
      //   return d.name
      // });
      // csvData.year = csvData.dimension(function(d) {
      //   return d.year
      // });
      // csvData.number = csvData.dimension(function(d) {
      //   return d.number
      // });
      //
      // csvData.nameGroups = csvData.name.group();
      // csvData.yearGroups = csvData.year.group();
      // csvData.numberGroups = csvData.number.group();
      // csvData.yearT = csvData.year.group(function(d) { return d.number; });

      // https://stackoverflow.com/questions/21992120/retrieving-values-in-crossfilter-dimension
      // console.log(typeof  csvData.year);
      // console.log(typeof  csvData.yearGroups);
      // var dimData = csvData.year.top(1);
      // dimData.forEach(function(x) {
      //   console.log(JSON.stringify(x));
      // })
      // var dimData = csvData.yearGroups.top(1);
      // dimData.forEach(function(x) {
      //   console.log(JSON.stringify(x));
      // })

      // barChartF.onMouseOver(function(d) {
      // //  csvData.year.filter(d.key);
      //   update();
      // }).onMouseOut(function() {
      //   // Clear the filter
      // //  csvData.year.filterAll();
      //   update();
      // });
      //
      // function update() {
      //   console.log("update");
      // //  console.log(csvData.yearT.all())
      //   d3.select("#bar")
      //     .datum(csvData.yearT.all())
      //     .call(barChartF)
      //     .select(".x.axis") //Adjusting the tick labels after drawn
      //     .selectAll(".tick text")
      //     .attr("transform", "translate(-8,-1) rotate(-45)");
      // }
      //
      // update();

    });
  </script>

</body>

</html>
