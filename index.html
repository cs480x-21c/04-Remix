<!DOCTYPE html>
<html>

<head>
  <link rel="shortcut icon" href="#">
</head>

<body>
  <div class="container-fluid">
  	<h1>D3 Brush and linking Tutorial <small>VAST 2017 Minichallenge 1</small></h1>
    <div class="row">
  		<div class="col-xs-12">
  			<h2>Timeline</h2>
  			<div id="timeline"></div>
  		</div>


  		<!-- On small screens fills the full grid, on medium+ ones only half -->
  		<div class="col-xs-12 col-md-4">
  			<h2>Car Types</h2>
  			<div class="barChart" id="carTypes"></div>
  		</div>

  		<!-- On small screens fills the full grid, on medium+ ones only half -->
  		<div class="col-xs-12 col-md-8">
  			<h2>Gates</h2>
  			<div class="barChart" id="gates"></div>
  		</div>

    </div>
  </div>

  <!-- https://cdnjs.com/libraries/crossfilter -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crossfilter/1.3.12/crossfilter.min.js"></script>
  <script src="https://d3js.org/d3.v4.min.js"></script>
<script src="js/barChart.js"></script>
  <script>


// var chartTimeline = timeSeriesChart()
//   .width(1000)
//   .x(function (d) { return d.key;})
//   .y(function (d) { return d.value;});
// var barChartGate = barChart()
//   .width(600)
//   .x(function (d) { return d.key;})
//   .y(function (d) { return d.value;});
var barChartSector = barChart()
  .x(function (d) { return d.key;})
  .y(function (d) { return d.value;});

d3.csv("earnings.csv",
  // function (d) {
  //   // This function is applied to each row of the dataset
  //   d.Timestamp = dateFmt(d.Timestamp);
  //   return d;
  // },
  function (data) {

    var csData = crossfilter(data);

    // We create dimensions for each attribute we want to filter by
    csData.sector = csData.dimension(function (d) { return d.Sector; }).filterFunction(function(d) { return d!=='Total'});
    csData.year = csData.dimension(function (d) { return d.Year; });
    csData.sex = csData.dimension(function (d) { return d.Sex; });
    csData.earnings = csData.dimension(function (d) { return d.EarningsGel; });
    csData.total = csData.dimension(function (d) { return d.Total; });
    // var dimData = csData.sector.top(Infinity);
    //     dimData.forEach(function (x) {
    //         console.log(JSON.stringify(x));
    //     });
    // We bin each dimension
    csData.sectorGroup = csData.sector.group().reduceSum(function(d) { return d.Total;});
    csData.yearGroup = csData.year.group();
    csData.sexGroup = csData.sex.group();

    var dimData = csData.yearGroup.top(Infinity);
        dimData.forEach(function (x) {
            console.log(JSON.stringify(x));
        });
    // chartTimeline.onBrushed(function (selected) {
    //   csData.name.filter(selected);
    //   update();
    // });

    barChartSector.onMouseOver(function (d) {
      csData.sector.filter(d.key);
      update();
    }).onMouseOut(function () {
      // Clear the filter
      csData.sector.filterAll();
      update();
    });

    // barChartGate.onMouseOver(function (d) {
    //   csData.dimGateName.filter(d.key);
    //   update();
    // }).onMouseOut(function () {
    //   // Clear the filter
    //   csData.dimGateName.filterAll();
    //   update();
    // });

    function update() {
      // d3.select("#timeline")
      //   .datum(csData.timesByHour.all())
      //   .call(chartTimeline);

      d3.select("#carTypes")
        .datum(csData.sectorGroup.all())
        .call(barChartSector);

      // d3.select("#gates")
      //   .datum(csData.gateNames.all())
      //   .call(barChartGate)
      //   .select(".x.axis") //Adjusting the tick labels after drawn
      //   .selectAll(".tick text")
      //   .attr("transform", "translate(-8,-1) rotate(-45)");
    }

    update();


  }
);

  </script>

</body>

</html>
