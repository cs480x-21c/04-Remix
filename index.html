<html>
  <body>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <!-- <script src="https://d3js.org/d3-time.v2.min.js"></script>
    <script src="https://d3js.org/d3-time-format.v3.min.js"></script> -->

    <div id="viz"></div>

    <script>
      console.log({ d3 });

      var margin = { top: 10, right: 30, bottom: 40, left: 50 },
        width = 520 - margin.left - margin.right,
        height = 520 - margin.top - margin.bottom;

      // append the svg object to the body of the page
      var svg = d3
        .select("#viz")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      d3.csv("/a4-softeng.csv").then(function (data) {
        console.log({ data });
        // console.log(JSON.parse(data))

        // Time formatting
        var parseDuration = d3.timeParse("%H:%M:%S");
        console.log(parseDuration("14:18:21"));

        // var parseDateTime = d3.timeParse("%Y-%m-%d %I:%M:%S %p")
        var parseDateTime = d3.timeParse("%Y-%m-%d %X");

        // X axis
        // var x = d3
        //   .scaleBand()
        //   .range([0, width])
        //   .domain(
        //     data.map(function (d) {
        //       console.log(parseDateTime(d.startDate + " " + d.startTime))
        //       return parseDateTime(d.startDate + " " + d.startTime);
        //     })
        //   )
        //   .padding(0.2);

        var x = d3
          .scaleTime()
          .domain(
            d3.extent(data, function (d) {
              return parseDateTime(d.startDate + " " + d.startTime);
            })
          )
          // .nice(d3.time.day, 1)
          .rangeRound([0, width - margin.left - margin.right]);
        svg
          .append("g")
          .attr("transform", "translate(0," + height + ")")
          .call(d3.axisBottom(x))
          .selectAll("text")
          .attr("transform", "translate(-10,0)rotate(-45)")
          .style("text-anchor", "end");

        // Add Y axis
        var y = d3
          .scaleTime()
          .domain(
            d3.extent(data, function (d) {
              return parseDuration(d.duration);
            })
          )
          .range([height, 0]);
        svg.append("g").call(d3.axisLeft(y));

        // Bars
        svg
          .selectAll("mybar")
          .data(data)
          .enter()
          .append("rect")
          .attr("x", function (d) {
            return x(d.startDate);
          })
          .attr("y", function (d) {
            return y(d.duration);
            return 30;
          })
          //   .attr("width", x.bandwidth())
          .attr("height", function (d) {
            //   console.log(d.duration)
            //   console.log(parseDuration(d.duration))
            // return height - y(d.duration);
            return 10;
          })
          .attr("fill", "#69b3a2");
      });
    </script>
  </body>
</html>
