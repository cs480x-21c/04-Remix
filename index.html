<! DOCTYPE html>
<meta charset=utf=8">

<!-- Load d3-->
<script src="https://d3js.org/d3.v4.min.js"></script>
<div id="viz"></div>

<script>
    let margin = {top: 10, right: 30, bottom: 30, left: 40},
        width = 460 - margin.left - margin.right,
        height = 400 - margin.top - margin.bottom

    let svg = d3.select('#viz')
        .append('svg')
            .attr('width', width + margin.left + margin.right)
            .attr('height', height + margin.top + margin.bottom)
        .append('g')
            .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')')

    d3.csv('data.csv', function (data) {
        let filtered = data.filter(function (d) {
            return d.FirstTry !== ''
        })
        let assumedReal = data.filter(function (d) {
            return (d.FirstTry !== '' && d.FirstTry !== '69')
        })

        let ratios = [];
        for (let i in filtered) {
            let ratio = filtered[i].SecondTry / ((filtered[i].FirstTry == 0) ? filtered[i].SecondTry : filtered[i].FirstTry)
            if (ratio < 1) ratio = -1 * (1 / ratio)
            ratios.push(ratio)
        }
        console.log(ratios)

        // let y0 = Math.max(Math.abs(d3.min(ratios)), Math.abs(d3.max(ratios)))
        //
        // let y = d3.scaleLinear()
        //     .domain([-y0, y0])
        //     .range([height, 0])
        //     .nice()
        //
        // let x = d3.scaleOrdinal()
        //     .domain(d3.range(data.length))
        //     // .roundRangeBands([0, width], .2)
        //
        // let yAxis = d3.svg.axis()
        //     .scale(y)
        //     .orient('left')
        //
        // svg.selectAll('.bar')
        //     .data(ratios)
        //     .enter()
        //     .append('rect')
        //     //class attr
        //     .attr('y', function(d) {return y(Math.max(0, d))})
        //     .attr('x', function (d, i) { return x(i)})
        //     .attr('height', function(d) { return Math.abs(y(d) - y(0))})
        //     // .attr('width', x.rangeBand())
        //
        // svg.append('g')
        //     .attr('class', 'x axis')
        //     .call(yAxis)
        //
        // svg.append("g")
        //     .attr("class", "y axis")
        //     .append("line")
        //     .attr("y1", y(0))
        //     .attr("y2", y(0))
        //     .attr("x1", 0)
        //     .attr("x2", width);


        let x = d3.scaleLinear()
            .domain([-5.5,5.5])
            .range([0,width])
        svg.append('g')
            .attr('transform', 'translate(0,' + height + ')')
            .call(d3.axisBottom(x))

        let histogram = d3.histogram()
            .value(function(d) {return d})
            .domain(x.domain())
            .thresholds(x.ticks(10))

        let bins = histogram(ratios)

        var y = d3.scaleLinear()
            .range([height, 0])
        //TODO: Figure out a good way to include negatives here
            y.domain([0, d3.max(bins, function (d) {return d.length})])
        svg.append('g')
            .call(d3.axisLeft(y))

        svg.selectAll('.bar')
            .data(bins)
            .enter()
            .append('rect')
                .attr('X', 1)
                .attr('transform', function (d) {return 'translate(' + x(d.x0) + ',' + y(d.length) + ')'})
                .attr('width', function (d) {return x(d.x1) - x(d.x0) - 1})
                .attr('height', function(d) {return height - y(d.length)})
                .style('fill', function(d) {
                    if (d.x0<0) return 'red'
                    else return 'green' })

    })

</script>