<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="style.css" />
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
    <script src="d3-legend.min.js"></script>
    <script src="//d3js.org/topojson.v2.min.js"></script>
  </head>

  <body>
    <h1>Remix: Average Female Height Per Country</h1>
    <button>test</button>
    <p></p>
    <svg id="heightvis" width="800" height="600"></svg>

  <script>
  // Chloropleth definition
  var heightvis = d3.select("svg"),
    width = +heightvis.attr("width"),
    height = +heightvis.attr("height");

  // Map and projection
  var path = d3.geoPath();
  var projection = d3.geoMercator()
    .scale(150)
    .center([0,20])
    .translate([width / 2, height / 2]);

  // Data and color scale
  var data = d3.map();
  var colorScale = d3.scaleThreshold()
    .domain([150, 153, 156, 159, 162, 165, 168, 170])
    .range(["#FFD6E7", "#FFC2DB", "#FFADCF", "#FF99C3", "#FF85B8", "#FF70AC", "#FF4794"]);

  // Load external data and boot - don't mess with this
  d3.queue()
    .defer(d3.json, "https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson")
    .defer(d3.csv, "data.csv", function(d) { data.set(d.ID, +d.Value); })
    .await(ready);

  // Tooltip definition
  var tooltip = d3.select("body")
    .append("div")
    .style("position", "absolute")
    .style("z-index", "10")
    .style("visibility", "hidden")
    .style("background", "#FFFFFF")
    .text("rah");

  function ready(error, topo) {

    let mouseOver = function(d) {
      d3.selectAll(".Country")
        .transition().duration(200)
        .style("opacity", .3)
        .style("stroke", "transparent");
      d3.select(this)
        .transition()
        .duration(200)
        .style("opacity", 1)
        .style("stroke", "black");
      tooltip.style("visibility", "visible");
    }

    let mouseMove = function(d) {
        tooltip.style("top", (event.pageY-10)+"px").style("left",(event.pageX+10)+"px");
    }

    let mouseLeave = function(d) {
      d3.selectAll(".Country")
        .transition()
        .duration(200)
        .style("opacity", .8)
        .style("stroke", "transparent")
      tooltip.style("visibility", "hidden");
    }

    // Draw the map
    heightvis.append("g")
      .selectAll("path")
      .data(topo.features)
      .enter()
      .append("path")
        // draw each country
        .attr("d", d3.geoPath()
          .projection(projection)
        )
        // set the color of each country
        .attr("fill", function (d) {
          d.total = data.get(d.id) || 0;
          return colorScale(d.total);
        })
        .style("stroke", "transparent")
        .attr("class", function(d){ return "Country" } )
        .style("opacity", .8)
        .on("mouseover", mouseOver)
        .on("mousemove", mouseMove)
        .on("mouseleave", mouseLeave);
    }
  </script>
  </body>
</html>
