<!DOCTYPE html>
<html>

<head>
  <!-- favicon error -->
  <link rel="shortcut icon" href="#">
  <style>
    .grid-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-gap: 0px;
    }
    .bar {
      fill: orange;
    }
    .bar:hover {
  fill: orangered ;
}
.d3-tip {
  line-height: 1;
  font-weight: bold;
  padding: 12px;
  background: rgba(0, 0, 0, 0.8);
  color: #fff;
  border-radius: 2px;
}


  </style>
</head>

<body>
  <h1>Republic of Georgia Employment Wages</h1>

  <div>
    <h2>Total Earnings (GEL)</h2>
    <div class="barChart" id="earningsByYear"></div>
  </div>
  <div>
    <div class="col-xs-12">
      <h2>Timeline</h2>
      <!-- <div id="timeline"></div> -->
    </div>



    <div class="grid-container">

      <div class="grid-child">
        <h2>Earnings by Sector (GEL)</h2>
        <div class="barChart" id="earningsBySector"></div>
      </div>
      <div class="grid-child">
        <h2>Earnings by Gender (GEL)</h2>
        <div class="barChart" id="earningsByGender"></div>
      </div>

    </div>

  <!-- https://cdnjs.com/libraries/crossfilter -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crossfilter/1.3.12/crossfilter.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/reductio/1.0.0/reductio.min.js" integrity="sha512-dpNFXYxfvCC775pj8TELHq4usthTiHrwSx4IcgZBnsHvBTIU1pm8jWXQaNhzY+AxjrlxgLXVtxktAWOo/0oCKA==" crossorigin="anonymous"></script>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="js/barChart.js"></script>
  <script src="js/timeSeries.js"></script>

  <script>
  var barChartSector = barChart()
    .x(function (d) { return d.key;})
    .y(function (d) { return d.value;});
    var barChartGender = barChart()
      .x(function (d) { return d.key;})
      .y(function (d) { return d.value;});

    d3.csv("earnings.csv",
      // function (d) {
      //   // This function is applied to each row of the dataset
      //   d.Timestamp = dateFmt(d.Timestamp);
      //   return d;
      // },
      function(data) {

        var earnings = crossfilter(data);

        // We create dimensions for each attribute we want to filter by
        earnings.sector = earnings.dimension(function(d) {
          return d.Sector;
        });
        earnings.year = earnings.dimension(function(d) {
          return d.Year;
        });
        earnings.gender = earnings.dimension(function(d) {
          return d.Sex;
        });
        earnings.earnings = earnings.dimension(function(d) {
          return d.EarningsGel;
        });
        earnings.total = earnings.dimension(function(d) {
          return d.Total;
        });
        // var dimData = earnings.sector.top(Infinity);
        //     dimData.forEach(function (x) {
        //         console.log(JSON.stringify(x));
        //     });
        // We bin each dimension
        earnings.sectorGroup = earnings.sector.group().reduceSum(function(d) {
          return d.Total;
        });
        earnings.yearGroup = earnings.year.group().reduceSum(function(d) {return d.Total;});
        earnings.genderGroup = earnings.gender.group().reduceSum(function(d) {
          return d.EarningsGel;
        });;

        var dimData = earnings.sectorGroup.top(Infinity);
        dimData.forEach(function(x) {
          console.log(JSON.stringify(x));
        });


        barChartSector.onMouseOver(function(d) {
          console.log(d.key);
          earnings.sector.filter(d.key);
          update();
        }).onMouseOut(function() {
          // Clear the filter
          earnings.sector.filterAll();
          update();
        });

        barChartGender.onMouseOver(function(d) {
          earnings.gender.filter(d.key);
          // earnings.sectorGroup = earnings.sector.group().reduceSum(function(d) {
          //   return d.EarningsTotal;
          // });
          update();
        }).onMouseOut(function() {
          // Clear the filter
          earnings.gender.filterAll();
          // earnings.sectorGroup = earnings.sector.group().reduceSum(function(d) {
          //   return d.Total;
          // });
          update();
        });

        // barChartGate.onMouseOver(function (d) {
        //   earnings.dimGateName.filter(d.key);
        //   update();
        // }).onMouseOut(function () {
        //   // Clear the filter
        //   earnings.dimGateName.filterAll();
        //   update();
        // });

        function update() {
          // d3.select("#earningsByYear")
          //   .datum(earnings.yearGroup.all())
          //   .call(barChartYear);

          d3.select("#earningsBySector")
            .datum(earnings.sectorGroup.all())
            .call(barChartSector);

          d3.select("#earningsByGender")
            .datum(earnings.genderGroup.all())
            .call(barChartSector);

          // d3.select("#gates")
          //   .datum(earnings.gateNames.all())
          //   .call(barChartGate)
          //   .select(".x.axis") //Adjusting the tick labels after drawn
          //   .selectAll(".tick text")
          //   .attr("transform", "translate(-8,-1) rotate(-45)");
        }

        update();


      }
    );
  </script>

</body>

</html>
